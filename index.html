<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
<title>Merry Christmas , ENG.Mina AbuSeifen</title>
<style>
  :root{
    --bg:#e8fbf7;
    --platform:#79caa1;
    --monkey:#8a5a34;
    --accent:#4aa07a;
    --muted:#41605a;
  }
  html,body{height:100%;margin:0;overflow:hidden;touch-action:none;}
  body{display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,var(--bg),#dff4ee);font-family:Inter, system-ui, Arial;color:var(--muted)}
  .wrap{width:min(720px,98vw);max-width:720px;padding:10px;box-sizing:border-box}
  h1{margin:0 0 10px 0;font-size:18px;text-align:center}
  canvas{display:block;width:100%;height:auto;aspect-ratio:720/640;border-radius:12px;box-shadow:0 10px 30px rgba(60,110,95,0.12);background:linear-gradient(180deg, rgba(255,255,255,0.25), transparent);touch-action:none}
  .hud{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-top:8px}
  .controls{display:flex;gap:8px}
  button{background:var(--accent);color:white;border:0;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
  button.ghost{background:transparent;color:var(--muted);border:1px solid rgba(65,96,90,0.08)}
  .panel{background:rgba(255,255,255,0.7);padding:10px;border-radius:8px;display:flex;gap:8px;align-items:center}
  .muted{color:var(--muted);font-size:13px}
  @media (max-width:520px){ h1{font-size:14px} .muted{font-size:11px} }
</style>
</head>
<body>
  <div class="wrap">
    <h1>Merry Christmas , ENG.Mina AbuSeifen</h1>
    <canvas id="game" width="720" height="640" aria-label="Monkey Jump Game"></canvas>
    <div class="hud">
      <div class="panel">
        <div class="muted">Score:</div><div id="score">0</div>
      </div>
      <div class="controls">
        <button id="start">Start</button>
        <button id="restart" class="ghost">Restart</button>
      </div>
    </div>
  </div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const W = canvas.width;
const H = canvas.height;

const scoreEl = document.getElementById('score');
const startBtn = document.getElementById('start');
const restartBtn = document.getElementById('restart');

const GRAVITY = 0.45;
const JUMP_VELOCITY = -12.5;
const H_SPEED = 3.6;
const MAX_PLATFORMS = 10;
const PLATFORM_WIDTH = 100;
const PLATFORM_HEIGHT = 14;
const PLATFORM_GAP_MIN = 60;
const PLATFORM_GAP_MAX = 110;
const START_Y = H - 120;

const player = {
  x: W * 0.5, y: START_Y, vx: 0, vy: 0, w: 36, h: 36, radius: 18,
  isAlive: true, canJump: false, img: null, imgLoaded: false
};

(() => {
  const img = new Image();
  img.src = 'player.jpeg';
  img.onload = () => {
    player.img = img; player.imgLoaded = true;
    const targetW = 48; const aspect = img.height / img.width || 1;
    player.w = targetW; player.h = Math.round(targetW * aspect);
    player.radius = Math.max(player.w, player.h) * 0.5;
  };
})();

const jumpSound = new Audio('jump.wav');
let lastJumpSound = 0;
const minJumpSoundInterval = 120;

const bgCanvas = document.createElement('canvas');
bgCanvas.width = W; bgCanvas.height = H;
const bgCtx = bgCanvas.getContext('2d');
let bgImageLoaded = false;
const bgImg = new Image();
bgImg.src = 'christmas-bg.jpg';
bgImg.onload = () => { bgCtx.drawImage(bgImg,0,0,W,H); bgImageLoaded = true; };

const giftImg = new Image();
let giftImgLoaded = false;
giftImg.src = 'santa-gift.jpg';
giftImg.onload = () => { giftImgLoaded = true; };

const santaImg = new Image();
let santaImgLoaded = false;
santaImg.src = './santa.png';
santaImg.onload = () => { santaImgLoaded = true; };

const SANTA_MIN_INTERVAL_MS = 10000;
const SANTA_MAX_INTERVAL_MS = 20000;
const SANTA_SPEED = 160;
let santa = { active:false, x:0, y:0, vx:0, vy:0, side:'left', targetX:0, targetY:0 };
let santaTimer = 0;
let santaNextIn = rand(SANTA_MIN_INTERVAL_MS, SANTA_MAX_INTERVAL_MS);

function scheduleNextSanta(){ santaTimer = 0; santaNextIn = rand(SANTA_MIN_INTERVAL_MS, SANTA_MAX_INTERVAL_MS); }

function spawnSanta(){
  const fromLeft = Math.random() < 0.5;
  santa.side = fromLeft ? 'left' : 'right';
  santa.x = fromLeft ? -80 : W + 80;
  const minY = cameraY + 80; const maxY = cameraY + Math.max(120, H - 200);
  santa.y = rand(minY, maxY);
  santa.targetX = player.x; santa.targetY = player.y;
  santa.active = true;
}

function giveSantaGift(){
  const gx = player.x + (Math.random()*40 - 20); const gy = player.y - 8;
  const r = 10 + Math.random()*6;
  gifts.push({x: gx, y: gy, vx: (Math.random()-0.5)*0.6, vy: -0.8 - Math.random()*0.6, life: 2200, ttl: 2200, r: r, value: 80, type: 'box'});
  score += 80; updateScore();
  for(let k=0;k<18;k++){
    particles.push({x: player.x, y: player.y, vx:(Math.random()-0.5)*3, vy:(Math.random()-1.5)*3, life:200 + Math.random()*220, ttl:200 + Math.random()*220, size:1 + Math.random()*3, color: 'rgba(255,240,180,0.98)'});
  }
}

function updateSanta(dtMs){
  if(!santa.active){
    santaTimer += dtMs; if(santaTimer >= santaNextIn){ spawnSanta(); scheduleNextSanta(); }
    return;
  }
  santa.targetX = player.x; santa.targetY = player.y;
  const dx = santa.targetX - santa.x; const dy = santa.targetY - santa.y;
  const dist = Math.hypot(dx, dy) || 1;
  const move = SANTA_SPEED * (dtMs/1000);
  santa.x += dx / dist * Math.min(move, dist);
  santa.y += dy / dist * Math.min(move, dist);
  if(Math.hypot(santa.x - player.x, santa.y - player.y) <= 40){ giveSantaGift(); santa.active = false; }
  if(santa.x < -160 || santa.x > W + 160) santa.active = false;
}

function renderSanta(ctx){
  if(!santa.active) return;
  const sx = santa.x, sy = santa.y - cameraY;
  ctx.save();
  ctx.translate(sx, sy);
  if(santaImgLoaded){ try{ ctx.drawImage(santaImg, -28, -28, 56, 56); }catch(e){} }
  else { ctx.fillStyle = '#d93030'; ctx.beginPath(); ctx.arc(0,0,20,0,Math.PI*2); ctx.fill(); }
  ctx.restore();
}

function drawChristmasBackground(){
  bgCtx.clearRect(0,0,W,H);
  const g = bgCtx.createLinearGradient(0,0,0,H);
  g.addColorStop(0,'#f7fbff'); g.addColorStop(1,'#e6f7f5');
  bgCtx.fillStyle = g; bgCtx.fillRect(0,0,W,H);
  bgCtx.fillStyle = '#ffffff'; bgCtx.fillRect(0, H-80, W, 80);
}
drawChristmasBackground();

let cameraY = 0, highestY = player.y, score = 0, keys = {left:false,right:false}, platforms = [], particles = [], gifts = [], animId = null, running = false, gameOver = false, lastTime = 0, tGlobal = 0, deltaTimeMs = 16.67;

function rand(min, max){ return Math.random()*(max-min)+min; }

function initPlatforms(){
  platforms = [];
  platforms.push({x:W*0.5 - 50, y: START_Y + 40, w: 100, h: 14, type:'static'});
  let y = START_Y + 40 - rand(60, 110);
  for(let i=1;i<MAX_PLATFORMS;i++){
    platforms.push({x: rand(20, W - 120), y: y, w: 100, h: 14, type:'normal'});
    y -= rand(PLATFORM_GAP_MIN, PLATFORM_GAP_MAX);
  }
}

function resetGame(){
  player.x = W*0.5; player.y = START_Y; player.vx = 0; player.vy = 0; player.isAlive = true;
  cameraY = 0; highestY = player.y; score = 0; gameOver = false;
  updateScore(); initPlatforms(); player.canJump = true;
  santa.active = false; scheduleNextSanta();
}

function startGame(){ if(running) return; resetGame(); running = true; animId = requestAnimationFrame(loop); }
function endGame(){ gameOver = true; running = false; cancelAnimationFrame(animId); render(); }

function updatePhysics(dt){
  if(keys.left) player.vx = -H_SPEED; else if(keys.right) player.vx = H_SPEED; else player.vx = 0;
  player.x += player.vx;
  const prevBottom = player.y + player.h/2;
  player.vy += GRAVITY; player.y += player.vy;
  if(player.x < -20) player.x = W + 20; if(player.x > W + 20) player.x = -20;

  if(player.vy >= 0){
    for(let p of platforms){
      if(prevBottom <= p.y && (player.y + player.h/2) >= p.y && player.x > p.x - 20 && player.x < p.x + p.w + 20){
        player.y = p.y - player.h/2; player.vy = 0; player.canJump = true; break;
      }
    }
  }
  const threshold = H * 0.35;
  if(player.y - cameraY < threshold) cameraY = player.y - threshold;
  if(player.y < highestY) highestY = player.y;
  score = Math.max(0, Math.floor((START_Y - highestY)));
  updateScore();

  platforms = platforms.filter(p => p.y - cameraY < H + 200);
  while(platforms.length < MAX_PLATFORMS){
    let topY = platforms.reduce((min, p)=>Math.min(min, p.y), Infinity);
    platforms.push({x: rand(20, W-120), y: topY - rand(60, 110), w: 100, h: 14, type:'normal'});
  }
  if(player.y - cameraY > H + 80) endGame();
}

function render(){
  ctx.clearRect(0,0,W,H);
  ctx.drawImage(bgImageLoaded ? bgImg : bgCanvas, 0, 0, W, H);
  ctx.fillStyle = '#79caa1';
  for(let p of platforms){
    ctx.beginPath();
    const r = 6; const sy = p.y - cameraY;
    ctx.roundRect(p.x, sy, p.w, p.h, r); ctx.fill();
  }
  renderSanta(ctx); renderParticles(ctx); renderGifts(ctx);
  const mx = player.x, my = player.y - cameraY;
  if(gameOver){
    const bounce = Math.sin(tGlobal * 4) * 15;
    if(giftImgLoaded) ctx.drawImage(giftImg, mx-40, my+bounce-40, 80, 80);
    ctx.fillStyle = 'rgba(255,255,255,0.7)'; ctx.fillRect(40, H/2 - 70, W-80, 120);
    ctx.fillStyle = '#123d2f'; ctx.font = '26px sans-serif'; ctx.textAlign='center';
    ctx.fillText('Game Over', W/2, H/2 - 20);
    ctx.fillText('Tap to Restart', W/2, H/2 + 12);
  } else {
    ctx.fillStyle = 'rgba(0,0,0,0.06)'; ctx.beginPath(); ctx.ellipse(mx+8,my+14,18,14,0,0,Math.PI*2); ctx.fill();
    if(player.imgLoaded){
      ctx.save(); blobPath(ctx, mx, my, 24, 0.7); ctx.clip();
      ctx.drawImage(player.img, mx-24, my-24, 48, 48); ctx.restore();
    } else {
      ctx.fillStyle = '#8a5a34'; ctx.beginPath(); ctx.arc(mx, my, 18, 0, Math.PI*2); ctx.fill();
    }
  }
}

function blobPath(ctx, x, y, r, seed=0){
  const n = 12; ctx.beginPath();
  for(let i=0;i<=n;i++){
    const angle = (i/n) * Math.PI * 2;
    const radius = r * (1 + 0.14 * Math.sin(angle*3 + seed));
    const px = x + Math.cos(angle) * radius, py = y + Math.sin(angle) * radius;
    if(i===0) ctx.moveTo(px,py); else ctx.lineTo(px,py);
  }
  ctx.closePath();
}

function spawnJumpBurst(){
  for(let i=0;i<10;i++) particles.push({x:player.x, y:player.y+20, vx:rand(-2,2), vy:rand(-1,1), life:420, ttl:420, size:rand(2,5), color:'rgba(170,220,255,0.8)'});
}
function spawnGiftsOnJump(){
  gifts.push({x:player.x, y:player.y, vx:rand(-0.5,0.5), vy:-1, life:1800, ttl:1800, r:8, value:40, type:'box'});
}

function updateParticles(dt){
  for(let i=particles.length-1;i>=0;i--){
    particles[i].y += 0.5; particles[i].life -= dt; if(particles[i].life<=0) particles.splice(i,1);
  }
}
function renderParticles(ctx){
  particles.forEach(p => { ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(p.x, p.y-cameraY, p.size, 0, Math.PI*2); ctx.fill(); });
}
function updateGifts(dt){
  for(let i=gifts.length-1;i>=0;i--){
    gifts[i].y += 0.5; gifts[i].life -= dt;
    if(Math.hypot(gifts[i].x-player.x, gifts[i].y-player.y) < 30){ score+=gifts[i].value; gifts.splice(i,1); updateScore(); }
    else if(gifts[i].life<=0) gifts.splice(i,1);
  }
}
function renderGifts(ctx){
  gifts.forEach(g => { if(giftImgLoaded) ctx.drawImage(giftImg, g.x-g.r, g.y-cameraY-g.r, g.r*2, g.r*2); });
}

function loop(time){
  if(!running) return;
  deltaTimeMs = time - lastTime || 16.67; lastTime = time; tGlobal = time/1000;
  updatePhysics(1); updateParticles(deltaTimeMs); updateGifts(deltaTimeMs); updateSanta(deltaTimeMs);
  render(); animId = requestAnimationFrame(loop);
}

// --- دعم الموبايل (Touch Support) ---
canvas.addEventListener('touchstart', (e) => {
  e.preventDefault();
  const touch = e.touches[0];
  const rect = canvas.getBoundingClientRect();
  const x = (touch.clientX - rect.left) * (canvas.width / rect.width);
  
  if (gameOver) { startGame(); return; }

  if (x < canvas.width / 2) { keys.left = true; keys.right = false; }
  else { keys.right = true; keys.left = false; }

  if (player.canJump) {
    player.vy = JUMP_VELOCITY; player.canJump = false;
    spawnJumpBurst(); spawnGiftsOnJump();
    try { jumpSound.currentTime = 0; jumpSound.play().catch(()=>{}); } catch(err){}
  }
}, {passive: false});

canvas.addEventListener('touchend', () => { keys.left = false; keys.right = false; });

window.addEventListener('keydown', (e)=>{
  if(e.code==='ArrowLeft') keys.left=true; if(e.code==='ArrowRight') keys.right=true;
  if((e.code==='Space'||e.code==='ArrowUp')){
    if(gameOver) startGame();
    else if(player.canJump){ player.vy=JUMP_VELOCITY; player.canJump=false; spawnJumpBurst(); spawnGiftsOnJump(); try{jumpSound.play()}catch(e){} }
  }
});
window.addEventListener('keyup', (e)=>{ if(e.code==='ArrowLeft') keys.left=false; if(e.code==='ArrowRight') keys.right=false; });

startBtn.addEventListener('click', ()=>{ startGame(); startBtn.disabled = true; });
restartBtn.addEventListener('click', ()=>{ startBtn.disabled = false; startGame(); });
function updateScore(){ scoreEl.textContent = score; }

resetGame();
</script>
</body>
</html>
